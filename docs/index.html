<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <!--<title>Determinantes por Menoriza√ß√£o Geom√©trica</title>-->
  <title>Determinantes por Menoriza√ß√£o Geom√©trica</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      margin: 20px;
    }
    .controls {
      padding: 10px;
      border: 1px solid #ccc;
      background: #f9f9f9;
    }
    table {
      border-collapse: collapse;
      margin-top: 10px;
    }
    td {
      border: 1px solid #444;
      padding: 6px 10px;
      min-width: 40px;
      text-align: center;
    }
    .pivot {
      background: #ffe066;
      font-weight: bold;
    }
    .highlight {
      background: #d0ebff;
    }
    .matrix-panel {
      margin-top: 20px;
    }
    .det-box {
      margin-top: 25px;
      padding: 12px;
      border: 1px solid #666;
      background: #f8f9fa;
    }
    .painel {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 15px;
    }
    .painel:not(.painel-fixo):empty {
      display: none;
    }
    td.pivo {
      background: #ffe066;
      font-weight: bold;
    }
    td.eliminada {
      background-color: #f1f3f5;
      color: #adb5bd;
    }
    #panels {
      display: flex;
      flex-direction: column;
      gap: 32px;
      align-items: flex-start;
    }
    #panels {
      padding-left: 16px;
    }
    #modo-teorico,
    #modo-didatico {
      display: flex;
      gap: 24px;
    }
    #modo-didatico {
      flex-direction: row;
    }
    #modo-didatico #painel-matriz {
      min-width: 260px;
    }
    #modo-teorico #painel-matriz-teorico {
      min-width: 260px;
    }
    #coluna-esquerda {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    table {
      table-layout: fixed;
    }

    .painel table {
      width: max-content;
      /* impede esticamento estranho */
    }

    .painel td {
      width: 48px;
      height: 48px;
      padding: 0;
    }
    #painel-matriz td {
      border: 1px solid #868e96;
    }
#painel-matriz td.box-2x2 {
  outline: 3px solid #ff922b;
  outline-offset: -3px;
  background: #fff4e6;
}
#painel-matriz td.menor-comp {
  outline: 2px solid #74c0fc;
  outline-offset: -2px;
}
    .remanescente {
      outline: 2px solid #4dabf7;
      outline-offset: -2px;
    }
    .instrucao-mc {
      font-size: 0.9em;
      color: #555;
      margin: 4px 0 8px 0;
      font-style: italic;
    }
    td.mc-ativo {
      background: #f1f3f5;
      /* cinza bem claro */
      outline: 2px solid #adb5bd;
      /* cinza discreto */
      font-weight: bold;
    }
    .instrucao-pivo {
      margin-top: 6px;
      font-size: 0.9em;
      color: #444;
      font-style: italic;
    }
    td.pivo-ativo {
      background-color: #74c0fc;
      color: #000;
      /* üîë for√ßa contraste */
      font-weight: bold;
      border: 2px solid #1c7ed6;
    }
    td.highlight {
      outline: 2px solid #4dabf7;
      outline-offset: -2px;
      background: transparent;
    }
    #painel-pc4 {
      display: none;
    }
    #painel-pc4 td.apagada {
      border: none;
      background: transparent;
    }
    #painel-pc4 td {
      position: relative;
    }
    #painel-pc4 .resultado-2x2 {
     font-size: 1.3em;
     font-weight: bold;
     color: #d9480f;
    }
    #painel-pc4 .valor-original {
      font-size: 0.7em;
      color: #868e96;
    }
.pc4-concluido {
  opacity: 0.95;
}
.pc4-concluido td {
  cursor: default;
}
#assinatura-metodo {
  margin-left: 332px;
  margin-top: -30px;
  opacity: 0.65; 
  pointer-events: none;
}
#assinatura-metodo svg {
  font-family: "Times New Roman", Times, serif;
}
.det-frase-ancora {
  margin-top: 20px;
  padding-top: 12px;
  border-top: 1px solid rgba(0, 0, 0, 0.15);

  text-align: center;
  font-family: "Times New Roman", Times, serif;
  font-size: 14px;
  color: #444;
  opacity: 0.6;

  pointer-events: none;
}
.det-frase-ancora-ext {
  margin-top: 8px;

  text-align: center;
  font-family: "Times New Roman", Times, serif;
  font-size: 13px;
  line-height: 1.4;

  color: #444;
  opacity: 0.55;

  transition: opacity 1.2s ease;
  pointer-events: none;
}
#creditos-projeto {
  margin-top: 40px;
  text-align: center;

  font-family: "Times New Roman", Times, serif;
  font-size: 13px;
  color: #444;
  opacity: 0.7;

  pointer-events: none;
}
#creditos-projeto div:last-child {
  margin-top: 4px;
  letter-spacing: 0.5px;
}
  </style>
</head>

<body>

  <h1>Determinantes por Menoriza√ß√£o Geom√©trica</h1>
<!-- ========================= -->
<!-- ASSINATURA CONCEITUAL SVG -->
<!-- ========================= -->
<div id="assinatura-metodo">
  <svg
    width="220"
    height="60"
    viewBox="0 0 220 60"
    xmlns="http://www.w3.org/2000/svg"
    aria-hidden="true"
  >
    <!-- Produt√≥rio -->
    <text x="10" y="42" font-size="34">‚àè</text>

    <!-- Limites -->
    <text x="20" y="16" font-size="12">n</text>
    <text x="15" y="60" font-size="12">k=1</text>

    <!-- P_k -->
    <text x="40" y="49" font-size="24">P</text>
    <text x="51" y="54" font-size="12">k</text>

    <!-- Expoente -->
    <text x="50" y="28" font-size="12">2‚àík</text>
  </svg>
</div>

<main id="app">

  <div class="controls">
    Ordem da matriz:
    <input type="number" id="order" min="1" max="6" value="3">

    <br><br>

    Modo:
    <select id="mode">
      <option value="theoretical">Te√≥rico</option>
      <option value="didactic">Did√°tico</option>
    </select>

    <br><br>

    Piv√¥:
    <select id="pivotMode">
      <option value="diagonal">Diagonal principal</option>
      <option value="random">Aleat√≥rio</option>
    </select>

    <br><br>

    <button onclick="gerarMatriz()">Gerar Matriz</button>
    <button id="runBtn" onclick="executar()" disabled>Executar</button>
  </div>

  <!-- PAIN√âIS -->
  <div id="panels">

    <!-- ================= TE√ìRICO ================= -->
    <div id="modo-teorico" class="teorico">
      <!-- Painel fixo: matriz e pain√©is te√≥ricos entram aqui -->
      <div id="painel-matriz-teorico" class="painel painel-fixo"></div>
    </div>

    <!-- ================= DID√ÅTICO ================= -->
    <div id="modo-didatico" class="didatico">

      <div id="coluna-esquerda">
        <div id="painel-pivo" class="painel"></div>
        <div id="painel-menor" class="painel"></div>
        <div id="painel-contribuicoes" class="painel"></div>
      </div>

      <!-- Matriz Original (Did√°tico) -->
      <div id="painel-matriz" class="painel painel-fixo"></div>
      <div id="painel-pc4" class="painel painel-fixo"></div>
    </div>

  </div>

  <!-- Resultado / Determinante -->
<div class="det-box" id="detBox">
  <div class="det-resultado"></div>

  <div class="det-frase-ancora">
    This visual model presents the determinant as a recursive construction driven by pivots.
  </div>
<div class="det-frase-ancora-ext" id="detFraseAncoraExt">
  The core idea is to treat the pivot as the central element of the construction.
  At each step, a pivot may be freely chosen,
  defining the next lower-order minor in a recursive process.
</div>
</div>
<div id="creditos-projeto">
  <div>with technical and conceptual collaboration</div>
  <div>ChatGPT ¬∑ OpenAI</div>
</div>
<section class="documentation">
  <h2>Documentation / Resources</h2>

  <ul>
    <li>
   <a href="Determinants_by_Geometric_Memorization_EN.pdf" target="_blank">
        Article (PDF ‚Äì English)
      </a>
    </li>

    <li>
<a href="Determinantes_Menoriza√ß√£o_24062020.pdf" target="_blank">
  Artigo (PDF ‚Äì Portugu√™s)
</a>
    </li>

    <li>

<a href="/../matlab/detp.m"download>
  MATLAB Script (.m)
</a>
    </li>

    <li>
<a href="/../README.md">
  README
</a>
    </li>
  </ul>
</section>
</main>
  <script>
    let appState = "INIT";
    let celulasPC4Resolvidas = new Set();
    // ===================================================
    // Fra√ß√µes
    // ===================================================
    function gcd(a, b) {
      return b ? gcd(b, a%b): Math.abs(a);
    }

    function frac(n, d) {
      if (d === 0) return {
        n: 1,
        d: 0
      };
      let g = gcd(n, d); n /= g; d /= g;
      if (d < 0) {
        n=-n; d=-d;
      }
      return {
        n,
        d
      };
    }
    function fmul(a, b) {
      return frac(a.n*b.n, a.d*b.d);
    }
    function fstr(f) {
      return f.d === 1 ? f.n: `${f.n}/${f.d}`;
    }
    function fpow(f, e) {
      if (e === 0) return frac(1, 1);

      let r = frac(1, 1);
      let base = f;

      let exp = Math.abs(e);
      for (let i = 0; i < exp; i++) {
        r = fmul(r, base);
      }

      if (e < 0) {
        r = frac(r.d, r.n); // inverte
      }

      return r;
    }
    function construirMatriz3x3Didatica(M4, pr, pc) {
      const M3 = [];

      for (let i = 0; i < 4; i++) {
        if (i === pr) continue;

        const row = [];
        for (let j = 0; j < 4; j++) {
          if (j === pc) continue;
          row.push(M4[i][j]);
        }

        M3.push(row);
      }

      return M3;
    }
    // ===================================================
    // Interface
    // ===================================================
    const panels = document.getElementById("panels");
    const detBox = document.getElementById("detBox");
    const runBtn = document.getElementById("runBtn");

    let matrizOriginal = null;
    let matrizDidaticaAtual = null;
    // ===================================================
    // Visualiza√ß√£o
    // ===================================================
    function drawPanel(M, pr, pc, k) {

      const div = document.createElement("div");
      div.className = "matrix-panel theoretical-panel";
      const h = document.createElement("h3");
      h.textContent = `‚Üì P${k}`;
      div.appendChild(h);

      const table = document.createElement("table");

      for (let i = 0; i < M.length; i++) {
        const tr = document.createElement("tr");
        for (let j = 0; j < M.length; j++) {
          const td = document.createElement("td");
          td.textContent = fstr(M[i][j]);
          if (i === pr && j === pc) td.className = "pivot";
          else if (i === pr || j === pc) td.className = "highlight";
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }

      div.appendChild(table);
      document.getElementById("modo-teorico").appendChild(div);
    }

    // ===================================================
    // Gera√ß√£o da matriz
    // ===================================================

function gerarMatrizBase(n) {
  matrizOriginal = [];

  for (let i = 0; i < n; i++) {
    matrizOriginal[i] = [];
    for (let j = 0; j < n; j++) {
      matrizOriginal[i][j] = {
        n: Math.floor(Math.random() * 9) - 4,
        d: 1
      };
    }
  }

  appState = "MATRIX_READY";
  runBtn.disabled = false;
}

function gerarMatrizTeorico() {
  const n = parseInt(document.getElementById("order").value);

  if (n < 1 || n > 6) {
    alert("Ordem inv√°lida");
    return;
  }

  limparTeorico();
  gerarMatrizBase(n);

  renderMatrizBase(matrizOriginal, "painel-matriz-teorico");
}

function gerarMatrizDidatico() {
  document.getElementById("order").value = 4;

  gerarMatrizBase(4);

  matrizDidaticaAtual = criarMatrizDidatica4x4(matrizOriginal);

  renderMatrizBase(matrizDidaticaAtual, "painel-matriz");
 // resetPC4();
}

function gerarMatriz() {
  limparCalculo(); // üëà chave do conserto

  const modo = document.getElementById("mode").value;

  if (modo === "theoretical") {
    gerarMatrizTeorico();
  } else {
    gerarMatrizDidatico();
  }
}

    // ===================================================
    // Menoriza√ß√£o geomÔøΩtrica
    // ===================================================
    function construirMenor(M, pr, pc) {
      const k = M.length;
      let next = [];

      for (let i = 0; i < k; i++) {
        if (i === pr) continue;
        let row = [];
        for (let j = 0; j < k; j++) {
          if (j === pc) continue;

          let r1 = Math.min(i, pr),
          r2 = Math.max(i, pr);
          let c1 = Math.min(j, pc),
          c2 = Math.max(j, pc);

          let a = M[r1][c1],
          b = M[r1][c2];
          let c = M[r2][c1],
          d = M[r2][c2];

          row.push(frac(a.n*d.n - b.n*c.n, a.d*d.d));
        }
        next.push(row);
      }
      return next;
    }

    // ===================================================
    // Execu√ß√£o
    // ===================================================
    function executar() {
celulasPC4Resolvidas.clear();
      resetPC4();
      detBox.innerHTML = "";
      if (appState !== "MATRIX_READY") return;
      if (!matrizOriginal) return;

      const mode = document.getElementById("mode").value;

      if (mode === "theoretical") {
        appState = "THEORETICAL_RUNNING";
        executarTeorico();
      } else {
        appState = "DIDACTIC_RUNNING";
        executarDidatico();
      }
    }
    
    function executarTeorico() {
      // TODO o cÔøΩdigo teÔøΩrico vem aqui
      //resetPC4();
      appState = "THEORETICAL_RUNNING";
      runBtn.disabled = true;
      limparTeorico();
      let pivotMode = document.getElementById("pivotMode").value;
      let M = matrizOriginal.map(r => r.map(x => ({
        ...x
      })));
      let n = M.length;
      let pivots = []; // [P_n, P_{n-1}, ..., P_1]

      // ============================
      // MENORIZA√É‚Ä°√É∆íO GEOM√É‚Ä∞TRICA
      // ============================
      let matrizSingular = false;

      for (let k = n; k >= 2; k--) {

        let pr = k - 1;
        let pc = k - 1;

        const pivoDiagonalZerado = (M[pr][pc].n === 0);

        if (pivotMode === "random" || pivoDiagonalZerado) {

          //  aqui estÔøΩ o ponto matemÔøΩtico real
          if (!existePivoNaoNulo(M, k)) {
            matrizSingular = true;
            break;
          }

          do {
            pr = Math.floor(Math.random() * k);
            pc = Math.floor(Math.random() * k);
          } while (M[pr][pc].n === 0);

        } else {
          pr = k - 1;
          pc = k - 1;
        }
        // usa (pr, pc)
        let Pk = M[pr][pc];
        pivots.push(Pk);
        drawPanel(M, pr, pc, k);

        M = construirMenor(M, pr, pc);
      }
      //Feedback  Matriz Singular
      if (matrizSingular) {
        alert(
          " Matriz singular detectada.\n\n" +
          "N√£o existe piv√¥ n√£o nulo em um dos estÔøΩgios.\n" +
          "Portanto, det(A) = 0."
        );

        limparTeorico();
        appState = "MATRIX_READY";
        runBtn.disabled = false;
        return;
      }
      // ============================
      // MATRIZ 1√É‚Äî1  √¢‚Ä†‚Äô  P1
      // ============================
      drawPanel(M, 0, 0, 1);
      pivots.push(M[0][0]); // P1 explÔøΩcito

      // ============================
      // DETERMINANTE √¢‚Ç¨‚Äú MODO TE√É‚ÄúRICO
      // ============================
      let det = frac(1, 1);
      let texto = "<h3>Modo Te√≥rico </h3>";
      let formula = "det(A) = ";
      for (let i = 0; i < pivots.length; i++) {
        let k = n - i;
        let exp = (k === 1) ? "": `^${2 - k}`;
        if (k === 2) exp = "^0";
        formula += `P${k}${exp}`;
        if (i < pivots.length - 1) formula += " ‚Ä¢ ";
      }

      texto += `<p><strong>${formula}</strong></p>`;
      texto += "<ul>";

      for (let i = 0; i < pivots.length; i++) {

        let k = n - i;
        let Pk = pivots[i];
        if (k === 1) {
          // P1 entra direto
          det = fmul(det, Pk);
          texto += `<li>P${k} = ${fstr(Pk)}</li>`;
        } else {
          let exp = 2 - k;
          let valor = fpow(Pk, exp); // √∞≈∏‚ÄòÀÜ POT√É≈†NCIA REAL

          det = fmul(det, valor); // √∞≈∏‚ÄòÀÜ MESMO valor

          texto += `<li>
          P${k}<sup>${exp}</sup> = ${fstr(valor)}
          </li>`;
        }

      }

      texto += "</ul>";
      texto += `<h3>Determinante</h3><p><strong>${fstr(det)}</strong></p>`;

      detBox.innerHTML = texto;
      appState = "MATRIX_READY";
      runBtn.disabled = false;
    }

    function existePivoNaoNulo(M, k) {
      for (let i = 0; i < k; i++) {
        for (let j = 0; j < k; j++) {
          if (M[i][j].n !== 0) return true;
        }
      }
      return false;
    }
    //====================================
    // Fun√ß√µes para adequa√ß√£o do modo DidÔøΩtico
    //====================================
    function executarDidatico() {
      //resetPC4();
      // === ESTADO GLOBAL DO DID√ÅTICO ===
      estadoDidatico = {
        mcAtivo: null,
        pmAtivo: null
      };

      // === LIMPEZA CONTROLADA (painÔøΩis do TeÔøΩrico) ===
      document
      .querySelectorAll("#panels .matrix-panel")
      .forEach(p => p.remove());

      document.getElementById("detBox").innerHTML = "";

      const orderInput = document.getElementById("order");
      if (orderInput) {
        orderInput.value = 4;
      }

      console.log("DidÔøΩtico iniciado");

      if (!matrizOriginal) return;

      // === MO: Matriz Original 4x4 ===
      matrizDidaticaAtual = criarMatrizDidatica4x4(matrizOriginal);
      renderMatrizBase(matrizDidaticaAtual);

      // === MC: Menor Complementar ===
      renderMenorComplementar( {
        onClick: onClickMC
      });

      // === PM N√ÉO EXISTE AINDA ===

      appState = "DIDATICO_READY";
    }

function onClickMC({ i, j }) {

  // üîÑ novo piv√¥ = novo ato no Painel 2√ó2
  celulasPC4Resolvidas.clear();

  // 1) estado
  estadoDidatico.mcAtivo = { i, j };
  estadoDidatico.pmAtivo = null;

  // 2) MO reage
  limparMOExcetoPivo();
  limparDestaque2x2MO();
  aplicarEstadoPivoNaMO(i, j);

  // 3) üé≠ ENTRA O PC4 EM CENA
  const pc4 = document.getElementById("painel-pc4");
  pc4.style.display = "block";
  pc4.innerHTML = `
    <h2 id="pc4Titulo">Painel 2√ó2</h2>
    <p id="pc4Subtitulo" class="instrucao-mc">
      Toque nas c√©lulas para explorar o menor complementar.
    </p>
  `;

  // 4) painel 2√ó2 (‚ö†Ô∏è escreve no DOM!)
  renderPainel2x2(matrizDidaticaAtual, i, j);

  // 5) üîé valor do piv√¥ (AGORA √â O √öLTIMO!)
  const valorPivo = matrizDidaticaAtual[i][j];

  if (valorPivo.n === 0) {
    const subtitulo = document.getElementById("pc4Subtitulo");
    subtitulo.innerHTML += `
      <br><span class="aviso-pivo-zero">
        ‚ö†Ô∏è <strong>Piv√¥ nulo.</strong>
        A menoriza√ß√£o ocorre, mas este piv√¥ n√£o contribui numericamente.
      </span>
    `;
  }
}

function atualizarTextoPC4() {
  const total = celulasPC4Resolvidas.size;

  const titulo = document.getElementById("pc4Titulo");
  const subtitulo = document.getElementById("pc4Subtitulo");

  if (!titulo || !subtitulo) return;

  if (total === 9) {
    titulo.textContent = "Menoriza√ß√£o conclu√≠da";
    subtitulo.textContent = "Este processo continua no modo Te√≥rico.";
    marcarPC4ComoConcluido();
  } else {
    titulo.textContent = "Painel 2√ó2";
    subtitulo.textContent = "Toque nas c√©lulas para explorar o menor complementar.";
  }
}

function marcarPC4ComoConcluido() {
  pc4.classList.add("pc4-concluido");
}

function resetPC4() {
  const pc4 = document.getElementById("painel-pc4");
  if (!pc4) return;

  pc4.style.display = "none";
  pc4.innerHTML = "";

  // limpa destaques geom√©tricos na MO
  limparDestaque2x2MO();

  // limpa estado l√≥gico relacionado
  if (typeof estadoDidatico === "object") {
    estadoDidatico.mcAtivo = null;
  }
}

    function renderMenorComplementar( {
      onClick
    }) {

      const painel = document.getElementById("painel-menor");

      painel.innerHTML = `
      <h3>Seletor de Piv√¥s</h3>
      <p class="instrucao-mc">
      Escolha e divulgue.
      </p>
      `;

      const table = document.createElement("table");

      for (let i = 0; i < 4; i++) {
        const tr = document.createElement("tr");

        for (let j = 0; j < 4; j++) {
          const td = document.createElement("td");
          td.textContent = `(${i + 1},${j + 1})`;

          td.dataset.i = i;
          td.dataset.j = j;

          td.addEventListener("click", () => {

            // ‚úÖ LIMPA o piv√¥ anterior no MC
            limparPivoAtivoMC();

            // ‚úÖ MARCA o piv√¥ atual no MC
            td.classList.add("pivo-ativo");

            // ‚úÖ DISPARA a lÔøΩgica didÔøΩtica (MO)
            onClickMC( {
              i, j
            });
          });

          tr.appendChild(td);
        }

        table.appendChild(tr);
      }

      painel.appendChild(table);
    }

function renderMatrizBase(matriz, painelId = "painel-matriz") {
  const painel = document.getElementById(painelId);
  painel.innerHTML = "<h2>Matriz Original</h2>";

  const table = document.createElement("table");

  matriz.forEach((linha, i) => {
    const tr = document.createElement("tr");

    linha.forEach((valor, j) => {
      const td = document.createElement("td");
      td.textContent = fstr(valor);
      td.dataset.row = i;
      td.dataset.col = j;
      tr.appendChild(td);
    });

    table.appendChild(tr);
  });

  painel.appendChild(table);
}

function renderPainel2x2(matriz, pivoI, pivoJ) {

  const pc4 = document.getElementById("painel-pc4");
pc4.innerHTML = `
  <h2 id="pc4Titulo">Painel 2√ó2</h2>
  <p id="pc4Subtitulo" class="instrucao-mc">
    Toque nas c√©lulas para explorar o menor complementar.
  </p>
`;

  const table = document.createElement("table");

  for (let i = 0; i < 4; i++) {
    const tr = document.createElement("tr");

    for (let j = 0; j < 4; j++) {
      const td = document.createElement("td");

      // üßΩ linha ou coluna do piv√¥ ‚Üí buraco
      if (i === pivoI || j === pivoJ) {
        td.classList.add("apagada");
        td.textContent = "";
      } else {
        td.textContent = fstr(matriz[i][j]);
        td.dataset.row = i;
        td.dataset.col = j;
td.style.cursor = "pointer";
td.addEventListener("click", () => {
  const { i: pI, j: pJ } = estadoDidatico.mcAtivo;

  // 1) destaque geom√©trico
  destacar2x2NaMO(i, j, pI, pJ);

  // 2) c√°lculo
  const valor = det2x2(i, j, pI, pJ, matrizDidaticaAtual);

  // 3) visual
  td.innerHTML = `
    <div class="resultado-2x2">${valor}</div>
    <div class="valor-original">${fstr(matriz[i][j])}</div>
  `;

  // 4) üîë MARCA ESTA C√âLULA COMO RESOLVIDA
  const idDaCelula = `${i}-${j}`;
  celulasPC4Resolvidas.add(idDaCelula);

  // 5) üîî ATUALIZA O TEXTO DO PAINEL
  atualizarTextoPC4();
});
      }

      tr.appendChild(td);
    }

    table.appendChild(tr);
  }

  pc4.appendChild(table);
}

    function destacarPivo(i, j) {
      const celula = document.querySelector(
        `#painel-matriz td[data-row="${i}"][data-col="${j}"]`
      );

      if (celula) {
        celula.classList.add("pivo");
      }
    }

    function destacarBlocoRemanescente(pivoI, pivoJ) {
      for (let i = 0; i < 4; i++) {
        for (let j = 0; j < 4; j++) {

          // pula linha e coluna do piv√¥
          if (i === pivoI || j === pivoJ) continue;

          const cell = getCell(i, j);
          if (cell) {
            cell.classList.add("highlight");
          }
        }
      }
    }
    
function destacar2x2NaMO(i, j, pivoI, pivoJ) {

  // limpa qualquer 2x2 anterior
  document.querySelectorAll("#painel-matriz td").forEach(td => {
    td.classList.remove("box-2x2");
  });

  // quatro v√©rtices do 2x2 geom√©trico
  const coords = [
    { i, j },
    { i, j: pivoJ },
    { i: pivoI, j },
    { i: pivoI, j: pivoJ }
  ];

  coords.forEach(({ i, j }) => {
    const cell = document.querySelector(
      `#painel-matriz td[data-row="${i}"][data-col="${j}"]`
    );
    if (cell) {
      cell.classList.add("box-2x2");
    }
  });
}

function det2x2(i, j, pivoI, pivoJ, matriz) {

  // ordena linhas
  const r1 = Math.min(i, pivoI);
  const r2 = Math.max(i, pivoI);

  // ordena colunas
  const c1 = Math.min(j, pivoJ);
  const c2 = Math.max(j, pivoJ);

  const a = matriz[r1][c1].n;
  const b = matriz[r1][c2].n;
  const c = matriz[r2][c1].n;
  const d = matriz[r2][c2].n;

  return a * d - b * c;
}

    function atenuarLinhaColuna(pivoI, pivoJ) {
      document.querySelectorAll("#painel-matriz td").forEach(td => {
        const i = Number(td.dataset.row);
        const j = Number(td.dataset.col);

        if (i === pivoI || j === pivoJ) {
          td.classList.add("eliminada");
        }
      });
    }

function limparModo() {

  /* ===== TE√ìRICO ===== */
  const teorico = document.getElementById("modo-teorico");
  if (teorico) {
    teorico.innerHTML = `
      <div id="painel-matriz-teorico" class="painel painel-fixo"></div>
    `;
  }

  /* ===== DID√ÅTICO ===== */
  [
    "painel-matriz",
    "painel-menor",
    "painel-pivo",
    "painel-contribuicoes"
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.innerHTML = "";
  });

  /* ===== ESTADO VISUAL ===== */
  runBtn.disabled = true;
}

function limparCalculo() {
celulasPC4Resolvidas.clear();
  resetPC4();
  limparModo();

  if (typeof detBox !== "undefined") {
    detBox.innerHTML = "";
  }

  matrizOriginal = [];
  appState = "IDLE";
  runBtn.disabled = true;
}

    function limparTeorico() {

      // limpa apenas painÔøΩis teÔøΩricos antigos
      document
      .querySelectorAll("#panels .theoretical-panel")
      .forEach(p => p.remove());

      detBox.innerHTML = "";
    }

    function limparPivoAtivoMC() {
      document
      .querySelectorAll("#painel-menor td")
      .forEach(td => td.classList.remove("pivo-ativo"));
    }

    function limparMOExcetoPivo() {
      document.querySelectorAll("#painel-matriz td").forEach(td => {
        td.classList.remove("highlight");
        td.classList.remove("eliminada");
        td.classList.remove("remanescente");
      });
    }

    function destacarPivoNaMO(i, j) {
      document.querySelectorAll("#painel-matriz td").forEach(td => {
        const row = Number(td.dataset.row);
        const col = Number(td.dataset.col);

        if (row === i && col === j) {
          td.classList.add("pivo-ativo");
        }
      });
    }

    function criarMatrizDidatica4x4(orig) {
      const M = [];

      for (let i = 0; i < 4; i++) {
        M[i] = [];
        for (let j = 0; j < 4; j++) {
          if (orig && orig[i] && orig[i][j]) {
            M[i][j] = {
              ...orig[i][j]
            };
          } else {
            // completa com 1 para evitar piv√¥ zero
            M[i][j] = {
              n: 1,
              d: 1
            };
          }
        }
      }

      return M;
    }

    function limparFechamento2x2() {
      document
      .querySelectorAll(".box-2x2")
      .forEach(td => td.classList.remove("box-2x2"));
    }

function limparDestaque2x2MO() {
  document.querySelectorAll("#painel-matriz td").forEach(td => {
    td.classList.remove("box-2x2");
  });
}

    function getCell(i, j) {
      return document.querySelector(
        `#painel-matriz td[data-row='${i}'][data-col='${j}']`
      );
    }

    function aplicarEstadoPivoNaMO(i, j) {
      // LIMPA TUDO da MO
      document.querySelectorAll("#painel-matriz td").forEach(td => {
        td.classList.remove(
          "highlight",
          "eliminada",
          "remanescente",
          "pivo",
          "pivo-ativo"
        );
      });

      // PIVÔøΩ
      destacarPivoNaMO(i, j);

      // LINHA + COLUNA
      atenuarLinhaColuna(i, j);

      // BLOCO 3ÔøΩ3
      destacarBlocoRemanescente(i, j);
    }

document.getElementById("mode").addEventListener("change", (e) => {
celulasPC4Resolvidas.clear();
  resetPC4(); // üî¥ mata o PC4 zumbi

  limparModo();

  if (e.target.value === "didactic") {
    document.getElementById("order").value = 4;
  }
});
  </script>
</body>
</html>
